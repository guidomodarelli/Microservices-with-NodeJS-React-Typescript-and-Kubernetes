## ‚öôÔ∏è Decisiones de Dise√±o para la Arquitectura de Microservicios

A continuaci√≥n, se detallan las **decisiones de dise√±o** que se implementar√°n para la construcci√≥n de los microservicios y la API, basadas en la experiencia y preferencias del instructor. Es importante notar que **estas decisiones no son inamovibles** y el dise√±o puede ser adaptado o mejorado seg√∫n las necesidades o ideas alternativas.

---

### üõ°Ô∏è Seguridad y Comunicaci√≥n Externa

Todas las comunicaciones externas se canalizar√°n a trav√©s del **API Gateway** por motivos de seguridad.

1Ô∏è‚É£ **No habr√° comunicaci√≥n directa de clientes a microservicios:**
* El *front-end* (cliente) **no se comunicar√° directamente** con ning√∫n microservicio (ej. *review service* o *chat service*).
* **Toda solicitud** del cliente **debe pasar por el API Gateway**.

2Ô∏è‚É£ **Acceso restringido a microservicios:**
* **Solo el API Gateway ser√° accesible desde el exterior.**
* Todos los dem√°s microservicios **no ser√°n accesibles desde fuera**. Los intentos de acceder a ellos directamente (ej. con Postman) ser√°n rechazados.

3Ô∏è‚É£ **Validaci√≥n de Solicitudes del API Gateway:**
* Cada solicitud que el API Gateway env√≠e a un microservicio incluir√° un **token especial** (distinto al token de autenticaci√≥n del usuario).
* Los microservicios validar√°n este token para **confirmar que la solicitud proviene efectivamente del API Gateway**. Si el token no contiene el valor requerido, la solicitud ser√° rechazada.

---

### üåê Estilos de Comunicaci√≥n

Se utilizar√°n dos estilos principales de comunicaci√≥n, dependiendo de si la interacci√≥n es entre el cliente y el API Gateway, o entre los microservicios.

#### Comunicaci√≥n Cliente ‚ÜîÔ∏è API Gateway ‚ÜîÔ∏è Microservicios

La comunicaci√≥n ser√° principalmente **s√≠ncrona (solicitud-respuesta)** y basada en **HTTP**.

4Ô∏è‚É£ **Comunicaci√≥n Cliente ‚ÜîÔ∏è API Gateway:**
* Se basar√° principalmente en **HTTP** (modelo solicitud/respuesta).
* Tambi√©n se implementar√° **Socket.IO** para comunicaciones en tiempo real.

5Ô∏è‚É£ **Comunicaci√≥n API Gateway ‚ÜîÔ∏è Microservicios:**
* Se basar√° en **HTTP** (ej. para *auth service*, *user service*, *chat service*, etc.).
* Tambi√©n se utilizar√° la **comunicaci√≥n as√≠ncrona con Socket.IO** para los servicios que requieran funciones en tiempo real.

6Ô∏è‚É£ **Tr√°fico de Socket.IO a trav√©s del API Gateway:**
* Al igual que con las solicitudes HTTP, **no se permitir√° la comunicaci√≥n directa de Socket.IO** entre el cliente y un microservicio.
* Toda comunicaci√≥n Socket.IO deber√° **pasar por el API Gateway**, que gestionar√° estas funcionalidades.

#### Comunicaci√≥n Inter-Proceso (Microservicios ‚ÜîÔ∏è Microservicios)

La comunicaci√≥n interna entre microservicios (aquellos que no son el API Gateway) ser√° estrictamente **as√≠ncrona y dirigida por eventos**.

7Ô∏è‚É£ **Solo Comunicaci√≥n Event-Driven:**
* Se implementar√° √∫nicamente el **estilo de comunicaci√≥n as√≠ncrono dirigido por eventos**.
* **No se utilizar√°n solicitudes HTTP directas** entre microservicios (ej. para que el *user service* obtenga datos del *auth service*). En su lugar, se emitir√° un **evento** y el servicio correspondiente enviar√° una **respuesta**.

8Ô∏è‚É£ **Uso de RabbitMQ:**
* Para la comunicaci√≥n dirigida por eventos, se utilizar√° **RabbitMQ**. La elecci√≥n es por experiencia personal, sin que haya una raz√≥n espec√≠fica que lo haga superior a otras opciones como Kafka.

---

### üîë Generaci√≥n y Gesti√≥n de Tokens (JWT)

9Ô∏è‚É£ **Gesti√≥n Centralizada de Tokens:**
* La **generaci√≥n y gesti√≥n de los tokens (JSON Web Tokens o JWT)** ser√° manejada por el **API Gateway**.
* Los dem√°s microservicios **no se encargar√°n de almacenar, gestionar o generar el token**.

üîü **Flujo del Token:**
* El ***Auth Service*** solo **genera el token** al crear una cuenta.
* Una vez generado, el *Auth Service* **env√≠a el token al API Gateway**.
* El API Gateway **almacena el token** (en cookies) y se encarga de su gesti√≥n.
* Los microservicios solo **verificar√°n si una solicitud contiene el token requerido** para permitir el acceso.

---

### üö® Gesti√≥n de Errores y Monitoreo

* **Errores de Servidor:** Los errores de servidor generados por cada microservicio se enviar√°n directamente al sistema de monitoreo y *logging*, que estar√° conectado a **Elasticsearch y Kibana**.
* **Errores de Cliente:** Los errores relacionados con el cliente (ej. credenciales inv√°lidas) ser√°n enviados por el microservicio al **API Gateway**, y este los **reenviar√° al cliente** que origin√≥ la solicitud.